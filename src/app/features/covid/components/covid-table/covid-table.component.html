<div class="container">

  <div class="form-group">
    <mat-form-field appearance="fill">
      <mat-label>Filter by Case Type</mat-label>
      <mat-select [(value)]="selectedCaseType" (selectionChange)="onCaseTypeChange($event.value)">
        <mat-option value="">All Cases</mat-option>
        <mat-option *ngFor="let caseType of caseTypes" [value]="caseType">
          {{ caseType }}
        </mat-option>
      </mat-select>
    </mat-form-field>
    <mat-form-field appearance="fill">
      <mat-label>Enter a date range</mat-label>
      <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
        <input matStartDate formControlName="startDate"  placeholder="Start date">
        <input matEndDate formControlName="endDate" placeholder="End date">
      </mat-date-range-input>
      <mat-hint>MM/DD/YYYY â€“ MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>

      <mat-error *ngIf="range.controls['startDate'].hasError('matStartDateInvalid')">Invalid start date</mat-error>
      <mat-error *ngIf="range.controls['endDate'].hasError('matEndDateInvalid')">Invalid end date</mat-error>
    </mat-form-field>
    <button mat-raised-button color="primary" (click)="loadData()">
      <mat-icon>search</mat-icon>
      Search
    </button>
    <button mat-raised-button color="warn" (click)="clearData()">
      <mat-icon>clear</mat-icon>
      Clear
    </button>
  </div>

  <div *ngIf="loading" class="loading-spinner">
    <mat-spinner></mat-spinner>
  </div>
  <div *ngIf="errorMessage" class="alert-message">
    {{errorMessage}}
  </div>
  <div class="table-container" *ngIf="!loading && dataSource.data.length > 0">
    <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Date </th>
        <td mat-cell *matCellDef="let element"> {{element.date | date}} </td>
      </ng-container>

      <ng-container matColumnDef="caseType">
        <th mat-header-cell *matHeaderCellDef> Case Type </th>
        <td mat-cell *matCellDef="let element"
        [ngClass]="{
          'case-confirmed': element.caseType === 'Confirmed',
          'case-probable': element.caseType === 'Probable',
          'case-recovered': element.caseType === 'Recovered',
          'case-death': element.caseType === 'Death'
        }" class="case-type">
      {{element.caseType}}
    </td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef> Total </th>
        <td mat-cell *matCellDef="let element"> {{element.total}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator [pageSize]="10" showFirstLastButtons></mat-paginator>
  </div>

  <div *ngIf="!loading && dataSource.data.length === 0" class="no-data">
    <i class="material-icons">info_outline</i>
    <p>No data available for the selected date range</p>
  </div>
</div>
